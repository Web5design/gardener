var out$ = typeof exports != 'undefined' && exports || this;
out$.listen = listen;
function listen(socket, onMessage){
  var buffer;
  socket.setEncoding('utf8');
  buffer = "";
  function msgFromBuffer(){
    var sep, msg_len, next_msg_start, result;
    sep = buffer.indexOf("\n");
    if (sep === -1) {
      return null;
    }
    msg_len = parseInt(buffer.substring(0, sep));
    next_msg_start = sep + msg_len + 1;
    if (next_msg_start > buffer.length) {
      return null;
    }
    result = JSON.parse(buffer.substring(sep + 1, next_msg_start));
    buffer = buffer.substring(next_msg_start);
    return result;
  }
  socket.on('data', function(data){
    var msg;
    buffer += data;
    while (msg = msgFromBuffer()) {
      onMessage(msg);
    }
  });
}
out$.send = send;
function send(socket, object){
  var str_msg;
  str_msg = JSON.stringify(object);
  socket.write(str_msg.length + "\n" + str_msg);
}